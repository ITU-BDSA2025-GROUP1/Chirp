@using Chirp.Core.Entities
@using Microsoft.AspNetCore.Identity
@inject UserManager<Author> UserManager
@{
    string? displayName = null;
    if (User.Identity?.IsAuthenticated == true)
    {
        var currentUser = await UserManager.GetUserAsync(User);
        displayName = currentUser?.Name ?? currentUser?.UserName ?? User.Identity?.Name;
    }

    var showCheepForm = (ViewData["ShowCheepForm"] as bool?) ?? false;
}
<!DOCTYPE html>
<html lang="en">
<head>
    <title>@ViewData["Title"]</title>
    <link href="/css/style.css" rel="stylesheet" type="text/css" />
    <link rel="icon" type="image/png" href="/favicon/favicon.ico">
</head>
<body>
<div class=page>
    <h1><img src="/images/icon1.png" alt="Icon1"/>Chirp!</h1>

    <div class = "navigation">
        @if (User.Identity?.IsAuthenticated == true)
        { 
            <div class = "navigation-links">
                <a href = "/@displayName"> My timeline </a> 
                <a href = "/" > Public timeline </a> <!-- also known as /Public -->
                <a href = "/About" > About me </a> <!-- name, email, following, all cheeps of user etc. -->
                <!-- Add a logout -->
                <a href = "/Account/Logout"> Logout </a>

            </div>
        }       
        else 
        {
            <div class = "navigation-links">
                <a href = "/" > Public timeline </a>
                <!-- Add a register -->
                <a href = "/Account/Register"> Register </a>
                <!-- Add a login -->
                <a href = "/Account/Login"> Login </a>
            </div>
        }
    </div>

    @if (showCheepForm && User.Identity?.IsAuthenticated == true)
    {
        <div class="cheepbox">
            <h3>What's on your mind @displayName?</h3>
            <form method="post" id="cheep-form" data-testid="cheep-form">
                <input id="cheep-input" type="text" name="text" class="cheep-input" />
                <button type="submit" class="cheep-btn">Share</button>
            </form>
            <div class="text-muted" style="font-size:0.8rem" id="cheep-hint" data-testid="cheep-hint">160 characters left</div>
            <script>
            (function(){
                const ta = document.getElementById('cheep-input');
                const hint = document.getElementById('cheep-hint');
                if(!ta || !hint) return;
                ta.addEventListener('input', function(){
                    const left = 160 - ta.value.length;
                    hint.textContent = left + ' characters left';
                    hint.style.color = left < 0 ? 'red' : '#666';
                });
            })();
        </script>
        </div>
    }
    <div class=body>
            @RenderBody()
    </div>
    <div class=footer>
        Chirp &mdash; An ASP.NET Application
    </div>
</div>

</body>
@await RenderSectionAsync("Scripts", required: false)
</html>






